<div class="roles-page">
  <!-- Header / Toolbar -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-text">
        <h1 class="page-title">
          <span class="title-icon">
            <i class="fas fa-user-shield"></i>
          </span>
          Roles Management
        </h1>
        <p class="page-subtitle">Manage, synchronize and maintain application roles</p>
      </div>
      <div class="d-flex gap-2 flex-wrap">
        <button class="btn-add-role" (click)="promptCreate()" [disabled]="isBusy()">
          <i class="fas fa-plus"></i>
          <span>Add New Role</span>
        </button>
        <button class="btn-ensure" (click)="syncRoles(false)" [disabled]="isBusy()">
          <i class="fas fa-sync-alt me-1"></i>Ensure
        </button>
        <button class="btn-prune" (click)="syncRoles(true)" [disabled]="isBusy()">
          <i class="fas fa-broom me-1"></i>Sync & Prune
        </button>
      </div>
    </div>
  </div>

  <div class="container-fluid px-4">
  <!-- Search / Status -->
  <div class="card shadow-sm mb-3">
    <div class="card-body d-flex gap-3 align-items-center flex-wrap">
      <div class="search-box d-flex align-items-center flex-grow-1">
        <i class="fas fa-search text-muted"></i>
        <input class="form-control" placeholder="Search roles..." [ngModel]="filterText()" (ngModelChange)="filterText.set($event)" />
      </div>
      <div class="stat-pill ms-auto">
        <i class="fas fa-layer-group me-2"></i>
        <span>{{ roles().length }} total</span>
      </div>
      <span class="text-muted small" *ngIf="lastSyncResult() as res">{{ res }}</span>
    </div>
  </div>

  <!-- Loading Skeleton -->
  <div class="card shadow-sm" *ngIf="isBusy()">
    <div class="list-group list-group-flush">
      <div class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let s of [1,2,3,4]">
        <div class="skeleton w-25"></div>
        <div class="d-flex gap-2">
          <div class="btn btn-sm btn-outline-secondary disabled placeholder"></div>
          <div class="btn btn-sm btn-outline-danger disabled placeholder"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cards Grid (Doctor-style) -->
  <div class="roles-grid" *ngIf="!isBusy() && filteredRoles.length > 0">
    <div class="role-card" *ngFor="let r of filteredRoles">
      <div class="role-card-header">
        <div class="role-avatar"><i class="fas fa-shield-alt"></i></div>
        <span class="badge rounded-pill bg-soft" *ngIf="['Admin','Doctor','Patient'].includes((r.name || '').toString())">built-in</span>
      </div>
      <div class="role-card-body">
        <h3 class="role-name"><i class="fas fa-tag me-2"></i>{{ r.name }}</h3>
        <div class="role-meta text-muted">ID: {{ r.id }}</div>
      </div>
      <div class="role-card-footer">
        <button class="action-btn view-btn" (click)="promptEdit(r)"><i class="fas fa-pen"></i></button>
        <button class="action-btn delete-btn" (click)="confirmDelete(r)"><i class="fas fa-trash"></i></button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="card shadow-sm empty-state" *ngIf="!isBusy() && filteredRoles.length === 0">
    <div class="card-body text-center py-5">
      <div class="empty-icon mb-3"><i class="fas fa-tags"></i></div>
      <h5 class="mb-1">No roles found</h5>
      <p class="text-muted mb-3">Create a new role or sync with server definitions.</p>
      <div class="d-flex justify-content-center gap-2">
        <button class="btn btn-success" (click)="promptCreate()"><i class="fas fa-plus me-1"></i> New Role</button>
        <button class="btn btn-outline-primary" (click)="syncRoles(false)"><i class="fas fa-sync-alt me-1"></i> Ensure</button>
      </div>
    </div>
  </div>

  <!-- Create Role Modal -->
  <div class="modal-backdrop" *ngIf="showCreateModal()" (click)="showCreateModal.set(false)"></div>
  <div class="modal-wrapper" *ngIf="showCreateModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff">
        <h3 class="modal-title"><i class="fas fa-plus me-2"></i>Create Role</h3>
        <button type="button" class="btn-close" (click)="showCreateModal.set(false)"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <label class="form-label">Role name <span class="text-danger">*</span></label>
        <input class="form-control" [ngModel]="createName()" (ngModelChange)="createName.set($event)" placeholder="e.g. Manager" />
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-secondary-modern" (click)="showCreateModal.set(false)" [disabled]="isSubmitting()">Cancel</button>
        <button type="button" class="btn-primary-modern" (click)="createRole()" [disabled]="isSubmitting() || !createName().trim()">
          <span *ngIf="!isSubmitting()"><i class="fas fa-save me-1"></i>Create</span>
          <span *ngIf="isSubmitting()"><span class="spinner-border spinner-border-sm me-2"></span>Saving...</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Role Modal -->
  <div class="modal-backdrop" *ngIf="showEditModal()" (click)="showEditModal.set(false)"></div>
  <div class="modal-wrapper" *ngIf="showEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-pen me-2"></i>Edit Role</h3>
        <button type="button" class="btn-close" (click)="showEditModal.set(false)"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <label class="form-label">Role name <span class="text-danger">*</span></label>
        <input class="form-control" [ngModel]="editName()" (ngModelChange)="editName.set($event)" />
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-secondary-modern" (click)="showEditModal.set(false)" [disabled]="isSubmitting()">Cancel</button>
        <button type="button" class="btn-primary-modern" (click)="updateRole()" [disabled]="isSubmitting() || !(editName()||'').toString().trim()">
          <span *ngIf="!isSubmitting()"><i class="fas fa-save me-1"></i>Update</span>
          <span *ngIf="isSubmitting()"><span class="spinner-border spinner-border-sm me-2"></span>Saving...</span>
        </button>
      </div>
    </div>
  </div>
  </div>
</div>


